<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <title>Keyboard Visualization</title>
        <meta name="description" content="This is a demonstration of a keyboard heatmap visualizing character distribution of text" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style.css" />
        <script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
    </head>
    <body>
        <div id="wrapper">
            <div id="header">
            <h1>Visualizing character distribution of texts on a keyboard </h1>
        </div>
        <div id="customize">
            <div id="customizearea">
                <label>Select a keyboard layout</label>
                <select id="layout">
                    <option value="ASSET">Asset</option>
                    <option value="CARPALX_QFMLWY">Carpalx QFMLWY</option>
                    <option value="COLEMAK">Colemak</option>
                    <option value="DVORAK">Dvorak</option>
                    <option value="DVORAK_PROGRAMMER">Dvorak Programmer</option>
                    <option value="MINIMAK_4K">Minimak 4-Keys</option>
                    <option value="MINIMAK_8K">Minimak 8-Keys</option>
                    <option value="MINIMAK_12K">Minimak 12-Keys</option>
                    <option value="NORMAN">Norman</option>
                    <option value="QWERTY" selected>QWERTY</option>
                    <option value="WORKMAN">Workman</option>
                </select>
                <div id="apply" class="button">
                    Select layout
                </div>
            </div>
        </div>
            <div id="keyboard">

            </div>
            <div id="footer">
            </div>
        </div>
        <script type="text/javascript">
            var app = {};
            app.config = {
                exclude: true
            };
        </script>
        <script src="heatmap.js"></script>
        <script src="keyboard-layouts.js"></script>
        <script type="text/javascript">
            (function(){

                app.init = function initialize(){
                    var cfg = arguments[0] || {};
                    var config = {};

                    config.element = "keyboard";
                    config.radius = cfg.radius || 50;
                    config.visible = true;
                    config.opacity = 40;
                    if(cfg.gradient)
                        config.gradient = cfg.gradient;

                    app.coordinates = app.LAYOUTS[cfg.layout || "QWERTY"];

                    // set the keyboard image
                    if(cfg.layout)
                       $("keyboard").style.backgroundImage = "url(img/"+cfg.layout+".png)";

                    var heatmap = h337.create(config);
                    app.heatmap = heatmap;
                };
                app.init();

                //var counts = {"q": 2,"w": 3,"e": 4,"r": 3,"t": 2,"y": 4,"u": 2, "i": 2,"o": 1,"p": 4, ":":3 };

                var counts = {"'": 21, "-": 1, ",": 0, "/": 6, ".": 8, ";": 5, "=": 0, "[": 0, "]": 0, "\\": 12, "a": 196, "`": 1788, "c": 111, "b": 160, "e": 233, "d": 82, "g": 1429, "f": 18, "i": 77, "h": 47, "k": 32, "j": 2, "m": 22, "l": 60, "o": 142, "n": 115, "q": 113, "p": 37, "s": 809, "r": 287, "u": 62, "t": 82, "w": 116, "v": 79, "y": 67, "x": 241, "z": 38};

                var digrams = {"gw": 1, "gv": 1, "gu": 0, "gt": 0, "gs": 14, "gr": 6, "gq": 1, "gp": 0, "gz": 1, "gy": 0, "gx": 1, "-]": 0, "gn": 0, "gm": 0, "gl": 1, "gk": 0, "gj": 0, "-[": 0, "gh": 0, "-e": 0, "-d": 0, "-g": 0, "-f": 0, "tz": 0, "-`": 0, "tx": 8, "ty": 1, "tv": 0, "tw": 0, "-o": 0, "-n": 0, "-i": 0, "-h": 0, "-k": 0, "-j": 0, "-u": 0, "-t": 0, "-w": 0, "-v": 1, "-q": 0, "-p": 0, "-s": 0, "-r": 0, "-y": 0, "-x": 0, "-z": 0, "-/": 0, "-.": 0, "ax": 10, "-=": 0, "-;": 0, "go": 3, "-\\": 0, "az": 3, "gi": 0, ";=": 0, "-a": 0, "-c": 0, "-b": 0, "-m": 0, "bw": 5, "-l": 0, "tu": 25, "/\\": 0, "`b": 0, "`c": 0, "`a": 1, "`f": 0, "`g": 0, "`d": 0, "`e": 0, "`j": 0, "`k": 0, "`h": 0, "`i": 0, "`n": 0, "`o": 0, "`l": 0, "`m": 0, "`r": 1, "`s": 11, "`p": 0, "`q": 1, "`v": 0, "`w": 0, "`t": 0, "`u": 0, "`z": 0, "`x": 5, "`y": 0, "mo": 1, "mn": 3, "/]": 0, "mu": 2, "mt": 0, "mw": 0, "mv": 1, "mq": 0, "mp": 3, "ms": 1, "mr": 0, "im": 2, "my": 0, "mx": 2, "mz": 0, "vw": 6, ",.": 0, ",/": 0, ",-": 0, ",=": 0, ",;": 0, "fp": 1, "fq": 0, "fr": 3, "fs": 1, "ft": 0, "fu": 0, "fv": 3, "fw": 0, "fx": 0, "fy": 0, "fz": 0, "fg": 0, "fh": 0, "fi": 7, "fj": 0, ",]": 0, "fl": 4, ",[": 0, "fn": 0, "fo": 4, ",f": 0, "sz": 10, "sy": 5, "sx": 48, ",b": 0, ",c": 0, ",`": 0, ",a": 0, ",n": 0, ",o": 0, ",l": 0, ",m": 0, "sw": 37, "sv": 12, ",h": 0, "st": 5, ",v": 0, ",w": 0, ",t": 0, ",u": 0, ",r": 0, ",s": 0, ",p": 0, ",q": 0, ",z": 0, ",x": 0, ",y": 0, "ux": 0, "ln": 0, "lo": 3, "lm": 1, "lv": 0, "lw": 0, "lt": 1, "lu": 1, "lr": 0, "ls": 3, "lp": 0, "lq": 0, "lz": 0, "lx": 0, "ly": 1, "yz": 0, "em": 1, "el": 16, "eo": 0, "en": 56, "ei": 1, "eh": 3, "ek": 7, "ej": 0, "eg": 1, "ef": 3, "ey": 11, "ex": 35, "ez": 0, "eu": 1, "et": 15, "ew": 4, "ev": 25, "eq": 4, "ep": 10, "es": 77, "er": 54, "rt": 5, "ru": 6, "rv": 10, "rw": 28, "rs": 62, "rx": 30, "ry": 0, "rz": 3, "[t": 0, "xz": 1, "xy": 0, ",\\": 0, "fk": 2, "fm": 0, ".;": 0, "[f": 0, ",g": 0, ",d": 0, ",e": 0, ",j": 0, ",k": 0, "su": 3, ",i": 0, "ko": 2, "kn": 3, "km": 0, "kl": 0, "ks": 4, "kr": 3, "kq": 0, "kp": 0, "kw": 2, "kv": 0, "ku": 0, "kt": 0, "kz": 0, "ky": 0, "kx": 0, ".]": 0, "=u": 0, "=t": 0, "=w": 0, "=v": 0, "=q": 0, "=p": 0, "=s": 0, "=r": 0, "=y": 0, "=x": 0, "=z": 0, "=e": 0, "=d": 0, "=g": 0, "=f": 0, "=a": 0, "=`": 0, "=c": 0, "=b": 0, "=m": 0, "=l": 0, "=o": 0, "=n": 0, "=i": 0, "=h": 0, "=k": 0, "=j": 0, "=]": 0, "=\\": 0, "=[": 0, "dn": 46, "do": 10, "dl": 1, "dm": 0, "dj": 0, "dk": 5, "dh": 0, "di": 7, "df": 0, "dg": 0, "de": 11, "dz": 0, "dx": 1, "dy": 0, "dv": 1, "dw": 0, "dt": 3, "du": 1, "dr": 4, "ds": 1, "dp": 0, "dq": 0, "qs": 46, "qr": 35, "qu": 1, "qt": 0, "qw": 47, "qv": 5, "qy": 0, "qx": 19, "qz": 4, ".b": 0, ".c": 1, "]u": 0, "]t": 0, "]w": 0, "]v": 0, "]q": 0, "]p": 0, "]s": 0, "]r": 0, "]y": 0, "]x": 0, "]z": 0, "]e": 0, "]d": 0, "]g": 0, "]f": 0, "]a": 0, "]`": 0, "]c": 0, "]b": 0, "]m": 0, "]l": 0, "]o": 0, "]n": 0, "]i": 0, "]h": 0, "]k": 0, "]j": 0, "jx": 0, "jy": 0, "jz": 0, "jt": 0, "ju": 0, "jv": 0, "jw": 0, "jp": 0, "jq": 0, "jr": 0, "js": 0, "jl": 0, "jm": 0, "jn": 0, "jo": 0, "jk": 2, "wz": 4, "wy": 0, "wx": 8, "ck": 3, "cj": 0, "ci": 2, "ch": 3, "co": 2, "cn": 0, "cm": 0, "cl": 0, "cg": 0, "cf": 0, "ce": 18, "cd": 1, "cz": 1, "cy": 0, "cx": 3, "cs": 6, "cr": 28, "cq": 4, "cp": 0, "cw": 6, "cv": 12, "cu": 21, "ct": 0, "pr": 2, "ps": 0, "pq": 0, "pv": 0, "pw": 2, "pt": 0, "pu": 4, "pz": 0, "px": 0, "py": 0, "'=": 0, ".\\": 0, "am": 8, ".[": 0, "iy": 0, "ix": 0, "iz": 2, "iq": 0, "ip": 0, "is": 3, "ir": 5, "iu": 0, "it": 13, "iw": 5, "iv": 0, "ay": 7, "ik": 14, "ij": 0, "/[": 0, "il": 25, "io": 0, "in": 5, "vx": 26, "vy": 1, "vz": 4, "/o": 0, "/n": 0, "/m": 0, "/l": 0, "/k": 0, "/j": 0, "/i": 0, "/h": 0, "/g": 0, "/f": 0, "/e": 2, "/d": 0, "/c": 1, "/b": 0, "/a": 0, "/`": 0, "/z": 0, "/y": 0, "/x": 0, "/w": 0, "/v": 0, "/u": 0, "/t": 0, "/s": 1, "/r": 0, "/q": 0, "/p": 0, "/=": 0, "/;": 0, "\\]": 0, "\\v": 0, "\\w": 0, "\\t": 0, "\\u": 0, "\\r": 0, "\\s": 2, "\\p": 0, "\\q": 0, "\\z": 0, "\\x": 0, "\\y": 0, "\\f": 0, "\\g": 0, "\\d": 0, "\\e": 0, "\\b": 0, "\\c": 0, "\\`": 0, "\\a": 0, "\\n": 0, "\\o": 0, "\\l": 0, "\\m": 0, "\\j": 0, "\\k": 0, "\\h": 0, "\\i": 0, ";s": 0, ";r": 1, ";q": 0, ";p": 1, ";w": 1, ";v": 0, ";u": 0, ";t": 0, ";z": 0, ";y": 0, ";x": 0, ";c": 0, ";b": 0, ";a": 0, ";`": 0, ";g": 0, ";f": 0, ";e": 1, ";d": 1, ";k": 0, ";j": 0, ";i": 0, ";h": 0, ";o": 0, ";n": 0, ";m": 0, ";l": 0, "uy": 0, ";[": 0, ";]": 0, ";\\": 0, "bd": 1, "be": 14, "bf": 0, "bg": 0, "bc": 10, "bl": 0, "bm": 2, "bn": 3, "bo": 1, "bh": 0, "bi": 2, "bj": 0, "bk": 0, "bt": 0, "bu": 28, "bv": 5, "uz": 6, "bp": 0, "bq": 14, "br": 53, "bs": 24, "bx": 33, "by": 1, "bz": 1, "oz": 2, "oy": 1, "ox": 0, "ow": 5, "ov": 4, "ou": 1, "ot": 16, "os": 40, "or": 21, "oq": 0, "op": 21, "[]": 0, "[\\": 0, "[s": 0, "[r": 0, "[q": 0, "[p": 0, "[w": 0, "[v": 0, "[u": 0, "./": 0, "[z": 0, "[y": 0, "[x": 0, "[c": 0, "[b": 0, "[a": 0, "[`": 0, "[g": 0, ".=": 0, "[e": 0, "[d": 0, "[k": 0, "[j": 0, "[i": 0, "[h": 0, "[o": 0, "[n": 0, "[m": 0, "[l": 0, "hz": 0, "hx": 1, "hy": 2, "hr": 0, "hs": 3, "hp": 3, "hq": 0, "hv": 0, "hw": 2, "ht": 5, "hu": 0, "hj": 0, "hk": 0, "hi": 0, "hn": 0, "ho": 12, "hl": 0, "hm": 0, ".h": 1, ".i": 0, ".j": 0, ".k": 0, ".l": 0, ".m": 0, ".n": 0, ".o": 0, ".`": 0, ".a": 0, "uw": 0, "uv": 0, ".d": 0, ".e": 0, ".f": 0, ".g": 0, ".x": 0, ".y": 0, ".z": 0, ".p": 0, ".q": 0, ".r": 0, ".s": 0, ".t": 0, ".u": 0, ".v": 0, ".w": 0, "ac": 17, "ab": 1, "ae": 10, "ad": 1, "ag": 7, "af": 0, "ai": 1, "ah": 20, "ak": 0, "aj": 0, "';": 0, "al": 11, "ao": 0, "an": 13, "aq": 5, "ap": 0, "as": 144, "ar": 10, "au": 1, "at": 2, "aw": 4, "av": 2, "'/": 0, "'.": 0, "'-": 0, "',": 0, "no": 22, "nx": 2, "ny": 0, "nz": 0, "np": 1, "nq": 2, "nr": 6, "ns": 7, "nt": 0, "nu": 2, "nv": 3, "nw": 1, "'w": 0, "'v": 0, "'u": 0, "'t": 6, "'s": 12, "'r": 0, "'q": 0, "'p": 0, "'z": 0, "'y": 2, "'x": 0, "'g": 0, "'f": 0, "'e": 1, "'d": 0, "'c": 0, "'b": 0, "'a": 0, "'`": 0, "'o": 0, "'n": 2, "'m": 0, "'l": 0, "'k": 0, "'j": 0, "'i": 5, "'h": 0, "']": 0, "'\\": 0, "'[": 0};

                //console.log(Object.keys(digrams).length);

                var repaint = function(){
                    var data = [],
                        max = 00,
                        temp = {},
                        coordinates = app.coordinates;

                    for(var i = 0; i < Object.keys(counts).length; i++){

                        var key = Object.keys(counts)[i];
                        if(/^[A-Za-z]$/.test(key)){
                            key = key.toUpperCase();
                        }
                        if(app.config.exclude && app.EXCLUDES.indexOf(key == -1)){
                            var coord;
                            coord = coordinates[key];

                            if(coord){
                                for(var s = 0; s < coord.length; s += 2) {
                                    var joined = coord.slice(s, s+2).join(";");
                                    if(!temp[joined])
                                        temp[joined] = 0;

                                    temp[joined] = counts[key.toLowerCase()];
                                }
                            }
                        }
                    }

                    for(var k in temp){
                        //console.log(k);
                        var xy = k.split(";");
                        var val = temp[k];

                        data.push({x: xy[0], y: xy[1], count: val});

                        if(val > max)
                            max = val;
                    }
                    
                    app.heatmap.store.setDataSet({max: max, data: data});
                }//end repaint function

                var $ = function(id){
                    return document.getElementById(id);
                };

                var gradients = [
                    { 0.45: "rgb(0,0,255)", 0.55: "rgb(0,255,255)", 0.65: "rgb(0,255,0)", 0.95: "yellow", 1.0: "rgb(255,0,0)"},
                    { 0.45: "rgb(255,255,255)", 0.70: "rgb(0,0,0)",0.9: "rgb(2,255,246)", 1.0: "rgb(3,34,66)"},
                    { 0.45: "rgb(216,136,211)", 0.55: "rgb(0,255,255)", 0.65: "rgb(233,59,233)", 0.95: "rgb(255,0,240)", 1.0: "yellow"}
                ];
                // function for button
                $("apply").onclick = function(){
                    var cfg = {};
                    //cfg.radius = Math.pow(10,$("fingertip").selectedIndex) +40;
                    //cfg.gradient = gradients[$("gradient").selectedIndex];
                    cfg.layout =  $("layout").value;
                    app.heatmap.cleanup();
                    app.init(cfg);
                    repaint();
                }
                repaint();

                var reDraw = function(){
                    var cfg = {};
                    //cfg.radius = Math.pow(10,$("fingertip").selectedIndex) +40;
                    //cfg.gradient = gradients[$("gradient").selectedIndex];
                    cfg.layout =  $("layout").value;
                    app.heatmap.cleanup();
                    app.init(cfg);
                    console.log("redrawn");
                    //repaint();

                }

                //document.addEventListener("click", redrawOnClick, false);

                function redrawOnClick(e) {
                    var xPosition = e.clientX - 320;
                    var yPosition = e.clientY - 225;
                    //console.log('x: ' + xPosition + ' y: '+ yPosition); //or return from this function

                    var ans;

                    for(var key in app.coordinates){
                        //console.log("x: " + app.coordinates[key][0] + " y: " + app.coordinates[key][1]);
                        var x = app.coordinates[key][0];
                        var y = app.coordinates[key][1];

                        //which key is pressed??
                        
                        if ( ((x-20) <= xPosition) && ((x+20) >= xPosition) && ((y-20) <= yPosition) && ((y+20) >= yPosition) ){
                            console.log('key: ' + key);
                            ans = key;
                            break;
                        }
                        else{
                            console.log("no key works");
                        }
                    } // end for

                    // redraw
                    for (var k in digrams){
                        //console.log("inside di: " + key)

                        if (ans){
                            if(k.indexOf(ans.toLowerCase()) != -1){
                                console.log("key " + k + " ans: " + ans.toLowerCase());
                            }
                        }

                    }

                    // get new data and then call repaint?
                    //reDraw();


                } // end function

            })();
        </script>
    </body>
</html>